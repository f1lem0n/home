#!/bin/bash

# initialization
echo
echo "ONLY RUN THIS SCRIPT ON A BRAND NEW SYSTEM."
echo "RUNNING IT MAY CORRUPT YOUR SYSTEM FILES!"
echo
read -p "Are you sure you want to run this script? [y/N]: " RUNARG

if [ ! -z $RUNARG ] && [[ "$RUNARG" =~ ^(y|Y|yes|YES|Yes)$ ]]; then
    :
else
    echo "Abandoning."
    exit
fi

# Installing/uninstalling the desired packages
sudo apt update -y && sudo apt upgrade -y
sudo apt install -y $(cat $HOME/bin/config/pckg.list)
sudo apt remove -y vi

# Etckeeper
cd /etc
sudo etckeeper init

# Cleanup
cd
rm -rf                                  \
    .profile                            \
    .bashrc                             \
    .bash_logout

# Generating ssh key
echo
if [ ! -f $HOME/.ssh/id_rsa ]; then
    echo "GENERATING SSH-RSA KEY."
    read -p "Type in your email: " EMAIL
    ssh-keygen -t rsa -C "$EMAIL" -f $HOME/.ssh/id_rsa -q -N ""
    echo
    echo "Copy this key into your github account:"
    echo
    cat $HOME/.ssh/id_rsa.pub
    echo
    read -p "Do you wish to continue? [y/N]: " RUNARG

    if [ ! -z $RUNARG ] && [[ "$RUNARG" =~ ^(y|Y|yes|YES|Yes)$ ]]; then
        :
    else
        echo "Abandoning."
        exit
    fi
else
    echo "SSH-RSA key already exists. Moving to the next job..."
fi

# Retrieving other frequently used repos
mkdir $HOME/Git
git clone git@github:f1lem0n/tutorials $HOME/Git/tutorials
git clone git@github:f1lem0n/Documents $HOME/Documents

# Installing conda
wget https://repo.anaconda.com/archive/Anaconda3-2022.10-Linux-x86_64.sh
sh Anaconda3-2022.10-Linux-x86_64.sh
rm Anaconda3-2022.10-Linux-x86_64.sh
conda update conda
conda update --all

# Installing my neovim build
git clone https://github.com/f1lem0n/nvim.git $HOME/.config/nvim
sh $HOME/.config/nvim/install.sh
